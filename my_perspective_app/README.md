## Following context are generated by GPT. Please read .txt documents under querytools\details folder for detailed information


# Project Overview

This is a project built using the MVP/MVC architecture.

Below is the **latest primary documentation**, replacing older instructions to allow new project members or external teams to quickly understand the **current** overall architecture, functionalities, module responsibilities, and interactions after recent updates. Please note this is an **integrated and complete documentation**, differing from previous incremental or historical descriptions—it reflects the **current latest version** of the project structure and design.

---

# I. Project Structure

```
my_perspective_app/
├── main.py
├── app.py
├── controllers
│   ├── main_controller.py
│   ├── preview_controller.py
│   ├── sync_controller.py
│   ├── settings_controller.py
│   ├── resource_manager.py
│   ├── cache_manager.py
│   └── shape_transform_controller.py
├── models
│   ├── transform_params.py
│   ├── image_item.py
│   └── shape_transform.py
├── views
│   ├── main_window.py
│   ├── preview_widget.py
│   ├── side_panel.py
│   ├── folder_selector.py
│   ├── thumbnail_bar.py
│   └── overlays
│       └── perspective_overlay.py
└── resources
    └── icons
        └── ... (icons and other resources)
```

**Main sections:**

* **Root Directory**: `main.py` (entry point), `app.py` (main application class)
* **Controllers**: Core business logic layer, managing previews, synchronization, shape manipulation, resource handling, etc.
* **Models**: Data structures and models, handling image/parameter data and file I/O.
* **Views**: UI layer, including main window, preview widgets, side panels, thumbnails, and overlay modules.
* **Resources**: Static resources such as icons.

---

# II. Project Purpose and Main Functions

This is a **multi-mode image preview and annotation application based on PySide6**, currently focused particularly on processing ID and document images. Users can load multiple images at once, marking or adjusting parameters in various modes. Key functionalities include:

1. **Batch Image Management & Drag-and-Drop Loading**
2. **Preview Area & Thumbnail Bar**
3. **Multiple Annotation Modes:**

   * **None**: View-only
   * **Perspective Transformation**: Drag points for precise perspective correction
   * **SAM2 Segmentation Mask**: Import checkpoints to sam2/checkpoints to use this function
   * **Perspective Regression based on SAM2 Masks**: Import checkpoints to sam2/checkpoints to use this function
4. **Perspective/Shape Transformations**
5. **Zoom & Canvas Height Adjustments**
6. **Caching Mode**
7. **Target Folder Synchronization** (normal and forced modes)
8. **External Configuration File** (`settings.txt` managed by `settings_controller.py`)
9. **Five-button Exit Dialog** (Force Sync, Save, Change Folder, Don't Save, Cancel)
10. **Multi-parameter File Handling** (currently `_verified.txt` in perspective mode)

---

# III. Main Module Descriptions

Brief module purposes are listed below. For detailed class/function descriptions, refer to corresponding `.py.txt` or source code files.

## 1. Root Directory

* **`main.py`**: Entry script initializing `QApplication`.
* **`app.py`**: `MyPerspectiveApp(QMainWindow)` main class, manages main UI and controllers.

## 2. Controllers Directory

* **`main_controller.py`**: Main window operations and interactions with other controllers.
* **`preview_controller.py`**: Manages previews, thumbnail interactions, and annotation parameter updates.
* **`shape_transform_controller.py`**: Core shape manipulation logic independent of UI.
* **`sync_controller.py`**: Handles file synchronization to target folders.
* **`settings_controller.py`**: Manages reading and writing of settings to `settings.txt`.
* **`resource_manager.py`**: Manages loaded images.
* **`cache_manager.py`**: Manages local caching of images and annotations.

## 3. Models Directory

* **`transform_params.py`**: Handles reading/writing corner coordinates to files.
* **`image_item.py`**: Represents individual images and associated data.
* **`shape_transform.py`**: Defines structures and logic for corner and midpoint transformations.

## 4. Views Directory

* **`main_window.py`**: Overall UI layout and interaction triggers.
* **`preview_widget.py`**: Displays images and manages annotation overlays.
* **`side_panel.py`**: Controls canvas settings like height and color.
* **`folder_selector.py`**: Allows changing target folders.
* **`thumbnail_bar.py`**: Thumbnail display and management.
* **`overlays/perspective_overlay.py`**: Handles perspective transformations.

---

# IV. Typical Workflow

1. **Launch**: Execute `python main.py`.
2. **Load Images**: Use menus or drag-and-drop; cached locally.
3. **Select Annotation Mode**: Choose from none, perspective, or future placeholders (SAM2).
4. **Perspective Adjustments**: Drag corners/midpoints; zoom and height adjustments available.
5. **Save**: Auto-save perspective changes; sync with target folders.
6. **Exit**: Five-option dialog to finalize work before exit.

---

# V. Further Reference

For detailed class/function implementations, consult corresponding `.txt` files (e.g., `shape_transform_controller.py.txt`, `preview_widget.py.txt`). These files contain method parameters, return values, and examples, aiding new teams in extending functionality. For future annotation modes like "SAM2," add parallel overlay classes similar to existing overlays.

---

This document provides a rapid overview of module responsibilities and interactions, incorporating recent updates in the multi-mode annotation and overlay architecture. For deeper details or unimplemented features like SAM2, please refer directly to source code or corresponding `.txt` files. Happy coding!
